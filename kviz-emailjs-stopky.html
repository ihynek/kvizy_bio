<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kvíz: Svalová soustava člověka</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        /* 
        =============================================================================
        EMAILJS KONFIGURACE - DOPLŇ ÚDAJE ZE SVÉHO EMAILJS ÚČTU
        =============================================================================
        
        NÁVOD JAK ZÍSKAT TYTO ÚDAJE:
        1. Jdi na https://www.emailjs.com/ a zaregistruj se (ZDARMA)
        2. Přidaj Email Service (Gmail doporučuji)
        3. Vytvoř Email Template
        4. Zkopíruj Public Key, Service ID a Template ID
        5. Vlož hodnoty níže
        
        =============================================================================
        */

        // TADY DOPLŇ SVÉ EMAILJS ÚDAJE:
        const EMAILJS_CONFIG = {
            publicKey: "DOPLŇ-SEM-PUBLIC-KEY",      // z Account -> General
            serviceId: "DOPLŇ-SEM-SERVICE-ID",      // z Email Services
            templateId: "DOPLŇ-SEM-TEMPLATE-ID"     // z Email Templates
        };

        // Inicializace EmailJS
        if (typeof emailjs !== 'undefined' && EMAILJS_CONFIG.publicKey !== "DOPLŇ-SEM-PUBLIC-KEY") {
            emailjs.init(EMAILJS_CONFIG.publicKey);
        }

        /* 
        =============================================================================
        UNIVERZÁLNÍ KVÍZ PRO STUDENTY
        =============================================================================
        */

        const MuscleQuiz = () => {
            // ========================================
            // NASTAVENÍ KVÍZU - TADY MĚNÍŠ OBSAH
            // ========================================
            
            const QUIZ_CONFIG = {
                title: "Svalová soustava člověka",
                teacherEmail: "hynek@gymberoun.cz",
                
                questions: [
                    {
                        id: 1,
                        type: 'multiple',
                        question: 'Která z následujících charakteristik NEPATŘÍ hladké svalovině?',
                        options: [
                            'Jednojadrová buňka',
                            'Přítomnost příčného pruhování',
                            'Nepodléhá vědomé kontrole',
                            'Nachází se ve stěnách dutých orgánů'
                        ],
                        correct: 1
                    },
                    {
                        id: 2,
                        type: 'multiple',
                        question: 'Srdeční svalovina má specifickou strukturu zvanou:',
                        options: [
                            'Tight junctions',
                            'Desmosomy',
                            'Vmezeřené ploténky (disci intercalares)',
                            'Gap junctions pouze'
                        ],
                        correct: 2
                    },
                    {
                        id: 3,
                        type: 'boolean',
                        question: 'Hladká svalovina obsahuje sarkomery uspořádané do pravidelné struktury.',
                        correct: false
                    },
                    {
                        id: 4,
                        type: 'multiple',
                        question: 'Kolik jader obsahuje typické vlákno příčně pruhované kosterní svaloviny?',
                        options: [
                            'Jedno jádro',
                            'Dvě jádra',
                            'Mnoho jader (mnohojaderné)',
                            'Žádné jádro'
                        ],
                        correct: 2
                    },
                    {
                        id: 5,
                        type: 'boolean',
                        question: 'Srdeční svalovina se na rozdíl od kosterní svaloviny nedokáže regenerovat.',
                        correct: false
                    }
                ]
            };

            // ========================================
            // SPRÁVA STAVU
            // ========================================
            const [answers, setAnswers] = useState({});
            const [submitted, setSubmitted] = useState(false);
            const [studentName, setStudentName] = useState('');
            const [studentSurname, setStudentSurname] = useState('');
            const [isSending, setIsSending] = useState(false);
            const [alreadyCompleted, setAlreadyCompleted] = useState(false);
            
            // ⏱️ STOPKY - nový state
            const [elapsedTime, setElapsedTime] = useState(0); // v sekundách
            const [startTime, setStartTime] = useState(null);

            // ========================================
            // KONTROLA, ZDAR JIŽ KVÍZ VYPLNĚN
            // ========================================
            useEffect(() => {
                const completed = localStorage.getItem('quiz_completed');
                if (completed === 'true') {
                    setAlreadyCompleted(true);
                }
            }, []);

            // ========================================
            // ⏱️ SPUŠTĚNÍ STOPEK PŘI NAČTENÍ
            // ========================================
            useEffect(() => {
                if (!alreadyCompleted && !submitted) {
                    setStartTime(Date.now());
                }
            }, [alreadyCompleted]);

            // ========================================
            // ⏱️ AKTUALIZACE ČASU KAŽDOU SEKUNDU
            // ========================================
            useEffect(() => {
                if (startTime && !submitted && !alreadyCompleted) {
                    const timer = setInterval(() => {
                        const now = Date.now();
                        const elapsed = Math.floor((now - startTime) / 1000);
                        setElapsedTime(elapsed);
                    }, 1000);

                    return () => clearInterval(timer);
                }
            }, [startTime, submitted, alreadyCompleted]);

            // ========================================
            // ⏱️ FORMÁTOVÁNÍ ČASU (např. "8 minut 23 sekund")
            // ========================================
            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                if (mins === 0) {
                    return `${secs} ${secs === 1 ? 'sekunda' : secs < 5 ? 'sekundy' : 'sekund'}`;
                }
                return `${mins} ${mins === 1 ? 'minuta' : mins < 5 ? 'minuty' : 'minut'} ${secs} ${secs === 1 ? 'sekunda' : secs < 5 ? 'sekundy' : 'sekund'}`;
            };

            // ========================================
            // ZPRACOVÁNÍ ODPOVĚDI
            // ========================================
            const handleAnswer = (questionId, answer) => {
                setAnswers(prev => ({
                    ...prev,
                    [questionId]: answer
                }));
            };

            // ========================================
            // VYHODNOCENÍ KVÍZU
            // ========================================
            const calculateResults = () => {
                let correct = 0;
                QUIZ_CONFIG.questions.forEach(q => {
                    if (answers[q.id] === q.correct) {
                        correct++;
                    }
                });
                
                const total = QUIZ_CONFIG.questions.length;
                const percentage = Math.round((correct / total) * 100);
                
                let grade;
                if (percentage >= 90) grade = 1;
                else if (percentage >= 75) grade = 2;
                else if (percentage >= 60) grade = 3;
                else if (percentage >= 50) grade = 4;
                else grade = 5;
                
                return { correct, total, percentage, grade };
            };

            // ========================================
            // ODESLÁNÍ E-MAILU přes EmailJS
            // ========================================
            const handleSubmit = async () => {
                if (!studentName.trim() || !studentSurname.trim()) {
                    alert('Vyplň prosím své jméno a příjmení.');
                    return;
                }

                const unanswered = QUIZ_CONFIG.questions.filter(q => answers[q.id] === undefined);
                if (unanswered.length > 0) {
                    alert(`Nezodpověděl/a jsi ${unanswered.length} otázek. Zodpověz prosím všechny otázky.`);
                    return;
                }

                // Uložit do localStorage HNED (kvíz = dokončen)
                localStorage.setItem('quiz_completed', 'true');

                const results = calculateResults();
                const timeFormatted = formatTime(elapsedTime);

                setIsSending(true);

                // Kontrola EmailJS konfigurace
                if (EMAILJS_CONFIG.publicKey === "DOPLŇ-SEM-PUBLIC-KEY") {
                    alert('⚠️ EmailJS není nakonfigurován! Doplň prosím Public Key, Service ID a Template ID do HTML souboru.');
                    setIsSending(false);
                    return;
                }

                // Parametry pro EmailJS šablonu
                const templateParams = {
                    student_name: `${studentName} ${studentSurname}`,
                    quiz_title: QUIZ_CONFIG.title,
                    score: results.correct,
                    total: results.total,
                    percentage: results.percentage,
                    grade: results.grade,
                    time: timeFormatted,  // ⏱️ Přidán čas
                    teacher_email: QUIZ_CONFIG.teacherEmail
                };

                try {
                    await emailjs.send(
                        EMAILJS_CONFIG.serviceId,
                        EMAILJS_CONFIG.templateId,
                        templateParams
                    );
                    
                    setSubmitted(true);
                    alert('✓ Výsledky byly úspěšně odeslány učiteli!');
                } catch (error) {
                    console.error('Chyba při odesílání e-mailu:', error);
                    alert('Nepodařilo se odeslat e-mail. Zkus to prosím znovu nebo kontaktuj učitele.');
                } finally {
                    setIsSending(false);
                }
            };

            // ========================================
            // ZOBRAZENÍ - KVÍZ JIŽ VYPLNĚN
            // ========================================
            if (alreadyCompleted) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-8 px-4">
                        <div className="max-w-2xl mx-auto">
                            <div className="bg-white rounded-2xl shadow-xl p-8 text-center">
                                <div className="text-6xl mb-4">⚠️</div>
                                <h2 className="text-2xl font-bold text-gray-800 mb-4">
                                    Kvíz již byl vyplněn
                                </h2>
                                <p className="text-gray-600">
                                    Tento kvíz jsi již dříve dokončil/a a odeslal/a výsledky učiteli.
                                    Každý student může kvíz vyplnit pouze jednou.
                                </p>
                            </div>
                        </div>
                    </div>
                );
            }

            // ========================================
            // ZOBRAZENÍ - POTVRZENÍ ODESLÁNÍ
            // ========================================
            if (submitted) {
                const results = calculateResults();
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-8 px-4">
                        <div className="max-w-2xl mx-auto">
                            <div className="bg-white rounded-2xl shadow-xl p-8">
                                <div className="text-center">
                                    <div className="text-6xl mb-4">✓</div>
                                    <h2 className="text-2xl font-bold text-green-600 mb-2">
                                        Výsledky byly úspěšně odeslány učiteli!
                                    </h2>
                                    <p className="text-gray-600 text-sm mt-3 mb-4">
                                        Nyní můžeš zavřít prohlížeč.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // ========================================
            // ZOBRAZENÍ - KVÍZ
            // ========================================
            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-8 px-4">
                    <div className="max-w-4xl mx-auto">
                        {/* HLAVIČKA */}
                        <div className="bg-white rounded-2xl shadow-xl p-6 mb-6">
                            <h1 className="text-3xl font-bold text-center text-gray-800 mb-2">
                                {QUIZ_CONFIG.title}
                            </h1>
                            <p className="text-center text-gray-600">
                                Celkem otázek: {QUIZ_CONFIG.questions.length}
                            </p>
                            
                            {/* ⏱️ ZOBRAZENÍ STOPEK */}
                            <div className="mt-4 text-center">
                                <div className="inline-flex items-center bg-blue-50 px-6 py-3 rounded-lg border-2 border-blue-200">
                                    <svg className="w-6 h-6 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    <span className="text-xl font-semibold text-blue-600">
                                        {formatTime(elapsedTime)}
                                    </span>
                                </div>
                            </div>
                        </div>

                        {/* FORMULÁŘ - JMÉNO A PŘÍJMENÍ */}
                        <div className="bg-white rounded-2xl shadow-xl p-6 mb-6">
                            <h3 className="text-lg font-semibold text-gray-800 mb-4">📝 Tvoje údaje</h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Jméno *
                                    </label>
                                    <input
                                        type="text"
                                        value={studentName}
                                        onChange={(e) => setStudentName(e.target.value)}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        placeholder="Jan"
                                        required
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Příjmení *
                                    </label>
                                    <input
                                        type="text"
                                        value={studentSurname}
                                        onChange={(e) => setStudentSurname(e.target.value)}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        placeholder="Novák"
                                        required
                                    />
                                </div>
                            </div>
                        </div>

                        {/* OTÁZKY */}
                        {QUIZ_CONFIG.questions.map((q, index) => (
                            <div key={q.id} className="bg-white rounded-2xl shadow-xl p-6 mb-6">
                                <h3 className="text-lg font-semibold text-gray-800 mb-4">
                                    {index + 1}. {q.question}
                                </h3>
                                
                                {q.type === 'multiple' ? (
                                    <div className="space-y-3">
                                        {q.options.map((option, optIndex) => (
                                            <button
                                                key={optIndex}
                                                onClick={() => handleAnswer(q.id, optIndex)}
                                                className={`w-full text-left px-4 py-3 rounded-lg border-2 transition-all ${
                                                    answers[q.id] === optIndex
                                                        ? 'border-blue-500 bg-blue-50 font-semibold'
                                                        : 'border-gray-200 hover:border-blue-300 hover:bg-gray-50'
                                                }`}
                                            >
                                                <span className="inline-block w-6 h-6 rounded-full border-2 mr-3 text-center leading-5 text-sm font-bold
                                                    ${answers[q.id] === optIndex ? 'border-blue-500 bg-blue-500 text-white' : 'border-gray-300'}">
                                                    {String.fromCharCode(65 + optIndex)}
                                                </span>
                                                {option}
                                            </button>
                                        ))}
                                    </div>
                                ) : (
                                    <div className="flex gap-4">
                                        <button
                                            onClick={() => handleAnswer(q.id, true)}
                                            className={`flex-1 px-6 py-3 rounded-lg border-2 font-semibold transition-all ${
                                                answers[q.id] === true
                                                    ? 'border-green-500 bg-green-50 text-green-700'
                                                    : 'border-gray-200 hover:border-green-300 text-gray-700'
                                            }`}
                                        >
                                            ✓ PRAVDA
                                        </button>
                                        <button
                                            onClick={() => handleAnswer(q.id, false)}
                                            className={`flex-1 px-6 py-3 rounded-lg border-2 font-semibold transition-all ${
                                                answers[q.id] === false
                                                    ? 'border-red-500 bg-red-50 text-red-700'
                                                    : 'border-gray-200 hover:border-red-300 text-gray-700'
                                            }`}
                                        >
                                            ✗ NEPRAVDA
                                        </button>
                                    </div>
                                )}
                            </div>
                        ))}

                        {/* TLAČÍTKO ODESLAT */}
                        <div className="bg-white rounded-2xl shadow-xl p-6">
                            <button
                                onClick={handleSubmit}
                                disabled={isSending}
                                className={`w-full py-4 rounded-lg font-bold text-lg transition-all ${
                                    isSending
                                        ? 'bg-gray-400 cursor-not-allowed'
                                        : 'bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white shadow-lg hover:shadow-xl'
                                }`}
                            >
                                {isSending ? '⏳ Odesílám...' : '📧 Odeslat výsledky učiteli'}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // ========================================
        // RENDEROVÁNÍ APLIKACE
        // ========================================
        ReactDOM.render(<MuscleQuiz />, document.getElementById('root'));
    </script>
</body>
</html>
