<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kv√≠z: Svalov√° soustava ƒçlovƒõka</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        /* 
        =============================================================================
        EMAILJS KONFIGURACE - DOPL≈á √öDAJE ZE SV√âHO EMAILJS √öƒåTU
        =============================================================================
        
        N√ÅVOD JAK Z√çSKAT TYTO √öDAJE:
        1. Jdi na https://www.emailjs.com/ a zaregistruj se (ZDARMA)
        2. P≈ôidaj Email Service (Gmail doporuƒçuji)
        3. Vytvo≈ô Email Template
        4. Zkop√≠ruj Public Key, Service ID a Template ID
        5. Vlo≈æ hodnoty n√≠≈æe
        
        =============================================================================
        */

        // TADY DOPL≈á SV√â EMAILJS √öDAJE:
        const EMAILJS_CONFIG = {
            publicKey: "DOPL≈á-SEM-PUBLIC-KEY",      // z Account -> General
            serviceId: "DOPL≈á-SEM-SERVICE-ID",      // z Email Services
            templateId: "DOPL≈á-SEM-TEMPLATE-ID"     // z Email Templates
        };

        // Inicializace EmailJS
        if (typeof emailjs !== 'undefined' && EMAILJS_CONFIG.publicKey !== "DOPL≈á-SEM-PUBLIC-KEY") {
            emailjs.init(EMAILJS_CONFIG.publicKey);
        }

        /* 
        =============================================================================
        UNIVERZ√ÅLN√ç KV√çZ PRO STUDENTY
        =============================================================================
        */

        const MuscleQuiz = () => {
            // ========================================
            // NASTAVEN√ç KV√çZU - TADY MƒöN√ç≈† OBSAH
            // ========================================
            
            const QUIZ_CONFIG = {
                title: "Svalov√° soustava ƒçlovƒõka",
                teacherEmail: "hynek@gymberoun.cz",
                
                questions: [
                    {
                        id: 1,
                        type: 'multiple',
                        question: 'Kter√° z n√°sleduj√≠c√≠ch charakteristik NEPAT≈ò√ç hladk√© svalovinƒõ?',
                        options: [
                            'Jednojadrov√° bu≈àka',
                            'P≈ô√≠tomnost p≈ô√≠ƒçn√©ho pruhov√°n√≠',
                            'Nepodl√©h√° vƒõdom√© kontrole',
                            'Nach√°z√≠ se ve stƒõn√°ch dut√Ωch org√°n≈Ø'
                        ],
                        correct: 1
                    },
                    {
                        id: 2,
                        type: 'multiple',
                        question: 'Srdeƒçn√≠ svalovina m√° specifickou strukturu zvanou:',
                        options: [
                            'Tight junctions',
                            'Desmosomy',
                            'Vmeze≈ôen√© plot√©nky (disci intercalares)',
                            'Gap junctions pouze'
                        ],
                        correct: 2
                    },
                    {
                        id: 3,
                        type: 'boolean',
                        question: 'Hladk√° svalovina obsahuje sarkomery uspo≈ô√°dan√© do pravideln√© struktury.',
                        correct: false
                    },
                    {
                        id: 4,
                        type: 'multiple',
                        question: 'Kolik jader obsahuje typick√© vl√°kno p≈ô√≠ƒçnƒõ pruhovan√© kostern√≠ svaloviny?',
                        options: [
                            'Jedno j√°dro',
                            'Dvƒõ j√°dra',
                            'Mnoho jader (mnohojadern√©)',
                            '≈Ω√°dn√© j√°dro'
                        ],
                        correct: 2
                    },
                    {
                        id: 5,
                        type: 'boolean',
                        question: 'Srdeƒçn√≠ svalovina se na rozd√≠l od kostern√≠ svaloviny nedok√°≈æe regenerovat.',
                        correct: false
                    }
                ]
            };

            // ========================================
            // SPR√ÅVA STAVU
            // ========================================
            const [answers, setAnswers] = useState({});
            const [submitted, setSubmitted] = useState(false);
            const [studentName, setStudentName] = useState('');
            const [studentSurname, setStudentSurname] = useState('');
            const [isSending, setIsSending] = useState(false);
            const [alreadyCompleted, setAlreadyCompleted] = useState(false);
            
            // ‚è±Ô∏è STOPKY - nov√Ω state
            const [elapsedTime, setElapsedTime] = useState(0); // v sekund√°ch
            const [startTime, setStartTime] = useState(null);

            // ========================================
            // KONTROLA, ZDAR JI≈Ω KV√çZ VYPLNƒöN
            // ========================================
            useEffect(() => {
                const completed = localStorage.getItem('quiz_completed');
                if (completed === 'true') {
                    setAlreadyCompleted(true);
                }
            }, []);

            // ========================================
            // ‚è±Ô∏è SPU≈†TƒöN√ç STOPEK P≈òI NAƒåTEN√ç
            // ========================================
            useEffect(() => {
                if (!alreadyCompleted && !submitted) {
                    setStartTime(Date.now());
                }
            }, [alreadyCompleted]);

            // ========================================
            // ‚è±Ô∏è AKTUALIZACE ƒåASU KA≈ΩDOU SEKUNDU
            // ========================================
            useEffect(() => {
                if (startTime && !submitted && !alreadyCompleted) {
                    const timer = setInterval(() => {
                        const now = Date.now();
                        const elapsed = Math.floor((now - startTime) / 1000);
                        setElapsedTime(elapsed);
                    }, 1000);

                    return () => clearInterval(timer);
                }
            }, [startTime, submitted, alreadyCompleted]);

            // ========================================
            // ‚è±Ô∏è FORM√ÅTOV√ÅN√ç ƒåASU (nap≈ô. "8 minut 23 sekund")
            // ========================================
            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                if (mins === 0) {
                    return `${secs} ${secs === 1 ? 'sekunda' : secs < 5 ? 'sekundy' : 'sekund'}`;
                }
                return `${mins} ${mins === 1 ? 'minuta' : mins < 5 ? 'minuty' : 'minut'} ${secs} ${secs === 1 ? 'sekunda' : secs < 5 ? 'sekundy' : 'sekund'}`;
            };

            // ========================================
            // ZPRACOV√ÅN√ç ODPOVƒöDI
            // ========================================
            const handleAnswer = (questionId, answer) => {
                setAnswers(prev => ({
                    ...prev,
                    [questionId]: answer
                }));
            };

            // ========================================
            // VYHODNOCEN√ç KV√çZU
            // ========================================
            const calculateResults = () => {
                let correct = 0;
                QUIZ_CONFIG.questions.forEach(q => {
                    if (answers[q.id] === q.correct) {
                        correct++;
                    }
                });
                
                const total = QUIZ_CONFIG.questions.length;
                const percentage = Math.round((correct / total) * 100);
                
                let grade;
                if (percentage >= 90) grade = 1;
                else if (percentage >= 75) grade = 2;
                else if (percentage >= 60) grade = 3;
                else if (percentage >= 50) grade = 4;
                else grade = 5;
                
                return { correct, total, percentage, grade };
            };

            // ========================================
            // ODESL√ÅN√ç E-MAILU p≈ôes EmailJS
            // ========================================
            const handleSubmit = async () => {
                if (!studentName.trim() || !studentSurname.trim()) {
                    alert('Vypl≈à pros√≠m sv√© jm√©no a p≈ô√≠jmen√≠.');
                    return;
                }

                const unanswered = QUIZ_CONFIG.questions.filter(q => answers[q.id] === undefined);
                if (unanswered.length > 0) {
                    alert(`Nezodpovƒõdƒõl/a jsi ${unanswered.length} ot√°zek. Zodpovƒõz pros√≠m v≈°echny ot√°zky.`);
                    return;
                }

                // Ulo≈æit do localStorage HNED (kv√≠z = dokonƒçen)
                localStorage.setItem('quiz_completed', 'true');

                const results = calculateResults();
                const timeFormatted = formatTime(elapsedTime);

                setIsSending(true);

                // Kontrola EmailJS konfigurace
                if (EMAILJS_CONFIG.publicKey === "DOPL≈á-SEM-PUBLIC-KEY") {
                    alert('‚ö†Ô∏è EmailJS nen√≠ nakonfigurov√°n! Dopl≈à pros√≠m Public Key, Service ID a Template ID do HTML souboru.');
                    setIsSending(false);
                    return;
                }

                // Parametry pro EmailJS ≈°ablonu
                const templateParams = {
                    student_name: `${studentName} ${studentSurname}`,
                    quiz_title: QUIZ_CONFIG.title,
                    score: results.correct,
                    total: results.total,
                    percentage: results.percentage,
                    grade: results.grade,
                    time: timeFormatted,  // ‚è±Ô∏è P≈ôid√°n ƒças
                    teacher_email: QUIZ_CONFIG.teacherEmail
                };

                try {
                    await emailjs.send(
                        EMAILJS_CONFIG.serviceId,
                        EMAILJS_CONFIG.templateId,
                        templateParams
                    );
                    
                    setSubmitted(true);
                    alert('‚úì V√Ωsledky byly √∫spƒõ≈°nƒõ odesl√°ny uƒçiteli!');
                } catch (error) {
                    console.error('Chyba p≈ôi odes√≠l√°n√≠ e-mailu:', error);
                    alert('Nepoda≈ôilo se odeslat e-mail. Zkus to pros√≠m znovu nebo kontaktuj uƒçitele.');
                } finally {
                    setIsSending(false);
                }
            };

            // ========================================
            // ZOBRAZEN√ç - KV√çZ JI≈Ω VYPLNƒöN
            // ========================================
            if (alreadyCompleted) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-8 px-4">
                        <div className="max-w-2xl mx-auto">
                            <div className="bg-white rounded-2xl shadow-xl p-8 text-center">
                                <div className="text-6xl mb-4">‚ö†Ô∏è</div>
                                <h2 className="text-2xl font-bold text-gray-800 mb-4">
                                    Kv√≠z ji≈æ byl vyplnƒõn
                                </h2>
                                <p className="text-gray-600">
                                    Tento kv√≠z jsi ji≈æ d≈ô√≠ve dokonƒçil/a a odeslal/a v√Ωsledky uƒçiteli.
                                    Ka≈æd√Ω student m≈Ø≈æe kv√≠z vyplnit pouze jednou.
                                </p>
                            </div>
                        </div>
                    </div>
                );
            }

            // ========================================
            // ZOBRAZEN√ç - POTVRZEN√ç ODESL√ÅN√ç
            // ========================================
            if (submitted) {
                const results = calculateResults();
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-8 px-4">
                        <div className="max-w-2xl mx-auto">
                            <div className="bg-white rounded-2xl shadow-xl p-8">
                                <div className="text-center">
                                    <div className="text-6xl mb-4">‚úì</div>
                                    <h2 className="text-2xl font-bold text-green-600 mb-2">
                                        V√Ωsledky byly √∫spƒõ≈°nƒõ odesl√°ny uƒçiteli!
                                    </h2>
                                    <p className="text-gray-600 text-sm mt-3 mb-4">
                                        Nyn√≠ m≈Ø≈æe≈° zav≈ô√≠t prohl√≠≈æeƒç.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // ========================================
            // ZOBRAZEN√ç - KV√çZ
            // ========================================
            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-8 px-4">
                    <div className="max-w-4xl mx-auto">
                        {/* HLAVIƒåKA */}
                        <div className="bg-white rounded-2xl shadow-xl p-6 mb-6">
                            <h1 className="text-3xl font-bold text-center text-gray-800 mb-2">
                                {QUIZ_CONFIG.title}
                            </h1>
                            <p className="text-center text-gray-600">
                                Celkem ot√°zek: {QUIZ_CONFIG.questions.length}
                            </p>
                            
                            {/* ‚è±Ô∏è ZOBRAZEN√ç STOPEK */}
                            <div className="mt-4 text-center">
                                <div className="inline-flex items-center bg-blue-50 px-6 py-3 rounded-lg border-2 border-blue-200">
                                    <svg className="w-6 h-6 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    <span className="text-xl font-semibold text-blue-600">
                                        {formatTime(elapsedTime)}
                                    </span>
                                </div>
                            </div>
                        </div>

                        {/* FORMUL√Å≈ò - JM√âNO A P≈ò√çJMEN√ç */}
                        <div className="bg-white rounded-2xl shadow-xl p-6 mb-6">
                            <h3 className="text-lg font-semibold text-gray-800 mb-4">üìù Tvoje √∫daje</h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Jm√©no *
                                    </label>
                                    <input
                                        type="text"
                                        value={studentName}
                                        onChange={(e) => setStudentName(e.target.value)}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        placeholder="Jan"
                                        required
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        P≈ô√≠jmen√≠ *
                                    </label>
                                    <input
                                        type="text"
                                        value={studentSurname}
                                        onChange={(e) => setStudentSurname(e.target.value)}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        placeholder="Nov√°k"
                                        required
                                    />
                                </div>
                            </div>
                        </div>

                        {/* OT√ÅZKY */}
                        {QUIZ_CONFIG.questions.map((q, index) => (
                            <div key={q.id} className="bg-white rounded-2xl shadow-xl p-6 mb-6">
                                <h3 className="text-lg font-semibold text-gray-800 mb-4">
                                    {index + 1}. {q.question}
                                </h3>
                                
                                {q.type === 'multiple' ? (
                                    <div className="space-y-3">
                                        {q.options.map((option, optIndex) => (
                                            <button
                                                key={optIndex}
                                                onClick={() => handleAnswer(q.id, optIndex)}
                                                className={`w-full text-left px-4 py-3 rounded-lg border-2 transition-all ${
                                                    answers[q.id] === optIndex
                                                        ? 'border-blue-500 bg-blue-50 font-semibold'
                                                        : 'border-gray-200 hover:border-blue-300 hover:bg-gray-50'
                                                }`}
                                            >
                                                <span className="inline-block w-6 h-6 rounded-full border-2 mr-3 text-center leading-5 text-sm font-bold
                                                    ${answers[q.id] === optIndex ? 'border-blue-500 bg-blue-500 text-white' : 'border-gray-300'}">
                                                    {String.fromCharCode(65 + optIndex)}
                                                </span>
                                                {option}
                                            </button>
                                        ))}
                                    </div>
                                ) : (
                                    <div className="flex gap-4">
                                        <button
                                            onClick={() => handleAnswer(q.id, true)}
                                            className={`flex-1 px-6 py-3 rounded-lg border-2 font-semibold transition-all ${
                                                answers[q.id] === true
                                                    ? 'border-green-500 bg-green-50 text-green-700'
                                                    : 'border-gray-200 hover:border-green-300 text-gray-700'
                                            }`}
                                        >
                                            ‚úì PRAVDA
                                        </button>
                                        <button
                                            onClick={() => handleAnswer(q.id, false)}
                                            className={`flex-1 px-6 py-3 rounded-lg border-2 font-semibold transition-all ${
                                                answers[q.id] === false
                                                    ? 'border-red-500 bg-red-50 text-red-700'
                                                    : 'border-gray-200 hover:border-red-300 text-gray-700'
                                            }`}
                                        >
                                            ‚úó NEPRAVDA
                                        </button>
                                    </div>
                                )}
                            </div>
                        ))}

                        {/* TLAƒå√çTKO ODESLAT */}
                        <div className="bg-white rounded-2xl shadow-xl p-6">
                            <button
                                onClick={handleSubmit}
                                disabled={isSending}
                                className={`w-full py-4 rounded-lg font-bold text-lg transition-all ${
                                    isSending
                                        ? 'bg-gray-400 cursor-not-allowed'
                                        : 'bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white shadow-lg hover:shadow-xl'
                                }`}
                            >
                                {isSending ? '‚è≥ Odes√≠l√°m...' : 'üìß Odeslat v√Ωsledky uƒçiteli'}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // ========================================
        // RENDEROV√ÅN√ç APLIKACE
        // ========================================
        ReactDOM.render(<MuscleQuiz />, document.getElementById('root'));
    </script>
</body>
</html>
